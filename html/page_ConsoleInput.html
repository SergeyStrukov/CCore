<!--
/* page_ConsoleInput.html */
//----------------------------------------------------------------------------------------
//
//  Project: CCore 1.02
//
//  License: Boost Software License - Version 1.0 - August 17th, 2003 
//
//            see http://www.boost.org/LICENSE_1_0.txt or the local copy
//
//  Copyright (c) 2012 Sergey Strukov. All rights reserved.
//
//----------------------------------------------------------------------------------------
-->

<!DOCTYPE html>
<html>

<head>

 <title>CCore -> Console input</title>

 <link href="CCore.css" rel="stylesheet" type="text/css">

</head>

<body>

<h2>Console input</h2>

<p class="Files">Files <b>CCore/inc/ReadCon.h</b> <b>CCore/src/ReadCon.cpp</b></p>

<p>
<b>ReadCon</b> is a class that can read a console input. Any class with the following interface
can be used as a console reader. There is a default console reader, defined in the header <b>CCore/inc/ReadCon.h</b>. 
Console reader performes the "non-buffered read without echo".
</p>

<pre>
class <span class="Att">ReadCon</span> : NoCopy
 {
   ....

  public:

   ReadCon();
   
   ~ReadCon();
   
   // get
   
   char get();
   
   bool get(MSec timeout,char &ret);
   
   bool get(TimeScope time_scope,char &ret);
   
   // put
   
   void put(char ch);
   
   void put(const char *str,ulen len);
   
   void put(StrLen str);
 };
</pre>

<p>
<b>get()</b> returns the next character from the console. This function can block indefinitely.
</p>

<p>
<b>get(MSec,char &)</b> returns the next character from the console, but waits up to time-out.
The return value is true, if the character was received.
</p>

<p>
<b>get(TimeScope,char &)</b> the same as previous, time-out is given as the <b>TimeScope</b>.
</p>

<p>
<b>put(char)</b> puts the single character to the console.
</p>

<p>
<b>put(const char *,ulen)</b> puts the string of character to the console.
</p>

<p>
<b>put(StrLen)</b> puts the string of character to the console.
</p>

<p>
All methods <b>put()</b> flushes output.
</p>

<h4>HCore console reader</h4>

<p>
<b>HCore</b> <b>ReadCon</b> is built upon the <b>Sys::ConRead</b> class, declared in the
header <b>sys/SysCon.h</b>.
</p>

<pre>
struct <span class="Att">Sys::ConRead</span>
 {
  ....

  // public
  
  struct IOResult
   {
    ulen len;
    ErrorType error;
   };
  
  ErrorType init() noexcept;
  
  ErrorType exit() noexcept;
  
  IOResult read(char *buf,ulen len) noexcept;
  
  IOResult read(char *buf,ulen len,MSec timeout) noexcept;
 };
</pre>

<h4>XCore console reader</h4>

<p>
<b>XCore</b> <b>ReadCon</b> constructor has the argument: <b>timeout</b>. It is used in methods
<b>put()</b> for nano-packet allocation. Normally, you should use the default value.
</p>

<pre>
class <span class="Att">ReadCon</span> : NoCopy
 {
   ....

  public:

   ReadCon(MSec timeout=DefaultTimeout);
   
</pre>

<p>
This class is implemented using the <b>Sys::OwnConInput</b> class, declared in the header 
<b>sys/SysCon.h</b>.
</p>

<pre>

/* consts */ 

enum ConInputResult
 {
  Con_Drop = 0,
  Con_Echo,
  Con_NoEcho,
  Con_EOL
 };
 
/* types */  

typedef Function&lt;ConInputResult (char)&gt; ConInputFunction;

/* class OwnConInput */

class <span class="Att">OwnConInput</span> : NoCopy
 {
   ....
   
  public:
   
   OwnConInput(TextLabel name,ConInputFunction input_any);
   
   ~OwnConInput();
 };

</pre>

<h4>(XCore) StdioReadCon</h4>

<p>
<b>XCore</b> provides an implementation of some C standard libray functions, including <b>stdio</b>
functions. By default, the <b>stdin</b> stream is not connected to any input.
To connect this stream to the console input, the class <b>StdioReadCon</b> is used.
</p>

<pre>
class <span class="Att">StdioReadCon</span> : NoCopy
 {
   ....

  public:
   
   StdioReadCon();
   
   ~StdioReadCon();
   
   class Register;
   
   class Access;
 };
</pre>

<p>
Constructor makes connection, destructor disconnects.
</p>

<h4>(XCore) RedirectPTPCon</h4>

<p>
Usually <b>XCore</b> console is backed by a serial port. But it is possible to redirect
console input/output to another device. The class <b>RedirectPTPCon</b> redirects the console
to a <a href="page_PTPCon.html"><b>PTPCon</b></a> device.
</p>

<pre>
class <span class="Att">RedirectPTPCon</span> : NoCopy
 {
   ....
    
  public:  
  
   RedirectPTPCon(StrLen con_device_name,StrLen name,const Net::PTPCon::Cfg &cfg=DefaultValue());
   
   ~RedirectPTPCon();
 };
</pre>

<p>
Constructor opens PTP console with the given name and configuration parameters using the given <b>PTPCon</b>
device. Then it redirects console to the PTP console.
</p>

<p>
Destructor stops redirection and closes the PTP console.
</p>

<h4>ReadPTPCon</h4>

<p>
The class <b>ReadPTPCon</b> is a <b>PTP Con</b> device reader. It is declared in the header
<b>print/PrintPTPCon.h</b>.
</p>

<pre>
class <span class="Att">ReadPTPCon</span> : NoCopy
 {
   ....

  public:
   
   // constructors
   
   explicit ReadPTPCon(PTPConOpenClose &con_openclose,MSec timeout=DefaultTimeout,ulen max_packets=DefaultMaxPackets);
   
   ~ReadPTPCon();
   
   // get
  
   char get();
   
   bool get(MSec timeout,char &ret);
   
   bool get(TimeScope time_scope,char &ret);
   
   // put, ignore errors
   
   void put(char ch);
   
   void put(const char *str,ulen len);
   
   void put(StrLen str);
 };
</pre>

<p>
Constructor binds the object to the <b>PTPConOpenClose</b> object to perform 
operations on the opened PTP console.
</p>

</body>

</html>

